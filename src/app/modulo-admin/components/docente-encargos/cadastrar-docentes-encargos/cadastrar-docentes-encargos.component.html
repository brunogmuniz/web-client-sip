<div class="card card-custom">
  <div class="card-header">
    <h3 class="card-title">Vincular Encargos</h3>
  </div>

  <div class="card-body">

    <form [formGroup]="encargoForm">
      <div class="mb-5">
        <label class="form-label text-gray-700 fw-semibold required">Docente</label>
        <select formControlName="idDocente"
                class="form-select form-select-solid"
                [class.is-invalid]="encargoForm.get('idDocente')?.invalid && encargoForm.get('idDocente')?.touched">
          <option [ngValue]="null" disabled>Selecione...</option>
          <option *ngFor="let d of docentesDisponiveis" [value]="d.id">
            {{ d.nome }} ({{ d.matricula }})
          </option>
        </select>
        <div *ngIf="encargoForm.get('idDocente')?.invalid && encargoForm.get('idDocente')?.touched"
             class="invalid-feedback d-block">
          Campo obrigatório
        </div>
      </div>
    </form>

    <div class="separator separator-dashed my-6"></div>

    <div class="p-5 bg-light-primary border border-primary border-dashed rounded mb-6">
      <h5 class="text-gray-800 fw-bold mb-4">
        <i class="la la-plus-circle text-primary fs-2 me-2"></i>
        Adicionar Área
      </h5>

      <form [formGroup]="subForm">
        <div class="row align-items-end g-4">
          <div class="col-md-6">
            <label class="form-label text-gray-700 fw-semibold required">Subárea</label>
            <select formControlName="subareaSelecionada"
                    class="form-select form-select-solid"
                    [class.is-invalid]="cSub['subareaSelecionada'].invalid && cSub['subareaSelecionada'].touched">
              <option [ngValue]="null" disabled>Selecione...</option>
              <ng-container *ngFor="let grupo of areasAgrupadas">
                <optgroup [label]="grupo.nomeArea">
                  <option *ngFor="let sub of grupo.subareas" [ngValue]="sub">
                    {{ sub.nome }}
                  </option>
                </optgroup>
              </ng-container>
            </select>
            <div *ngIf="cSub['subareaSelecionada'].invalid && cSub['subareaSelecionada'].touched" class="invalid-feedback d-block">
              Campo obrigatório
            </div>
          </div>

          <div class="col-md-3">
            <label class="form-label text-gray-700 fw-semibold required">Percentual (%)</label>
            <input type="number"
                   formControlName="percentual"
                   class="form-control form-control-solid"
                   placeholder="0"
                   min="0"
                   max="100"
                   step="0.1"
                   [class.is-invalid]="cSub['percentual'].invalid && cSub['percentual'].touched" />
            <div *ngIf="cSub['percentual'].invalid && cSub['percentual'].touched" class="invalid-feedback d-block">
              <span *ngIf="cSub['percentual'].hasError('required')">Campo obrigatório</span>
              <span *ngIf="cSub['percentual'].hasError('min')">Valor mínimo: 0%</span>
              <span *ngIf="cSub['percentual'].hasError('max')">Valor máximo: 100%</span>
            </div>
          </div>

          <div class="col-md-3">
            <label class="form-label fw-semibold d-none d-md-block">&nbsp;</label>
            <button type="button"
                    class="btn btn-success w-100"
                    (click)="adicionarEncargo()"
                    [disabled]="subForm.invalid">
              <i class="la la-plus"></i> Incluir
            </button>
          </div>
        </div>
      </form>
    </div>

    <div *ngIf="encargosAtuais.length > 0">
      <div class="separator separator-dashed my-6"></div>

      <div class="table-responsive">
        <table class="table table-row-bordered table-row-gray-300 align-middle gs-3 gy-4">
          <thead>
          <tr class="fw-bold fs-6 text-gray-800 border-bottom-2 border-gray-200">
            <th class="min-w-150px">Área</th>
            <th class="min-w-200px">Subárea</th>
            <th class="min-w-100px text-end">% Atuação</th>
            <th class="min-w-100px text-center">Ação</th>
          </tr>
          </thead>
          <tbody class="fs-6">
          <tr *ngFor="let enc of encargosAtuais; let i = index">
            <td><span class="text-gray-800 fw-semibold">{{ enc.nomeArea
